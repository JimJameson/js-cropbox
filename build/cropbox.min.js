var Cropbox=function(t,e){"use strict";function i(t,e){e="object"==typeof t?t:Object.assign(e||{},{cb:t}),this._configurate(e),this._initEvents()}var a={zoomIn:function(){this._ratio*=1.01;var t=this._sourceImage.width*this._ratio,e=this._sourceImage.height*this._ratio;this._zoom(t,e),this._refrashPosFrame(this._frame.offsetLeft,this._frame.offsetTop)},zoomOut:function(){var t=this._ratio;this._ratio*=.99;var e=this._sourceImage.width*this._ratio,i=this._sourceImage.height*this._ratio;e>=this._frame.clientWidth&&i>=this._frame.clientHeight?(this._zoom(e,i),this._refrashPosFrame(this._frame.offsetLeft,this._frame.offsetTop)):this._ratio=t},load:function(t){this._sourceImage.src=t},reset:function(){this._clearData(),this._resetVariant(),this._hideWorkarea(),this._disableControls(),this._trigger("cb.reset")},crop:function(){var t=this._frame.offsetLeft-this._image.offsetLeft,i=this._frame.offsetTop-this._image.offsetTop,a=this._frame.clientWidth,s=this._frame.clientHeight,r=e.createElement("canvas");r.width=a,r.height=s,r.getContext("2d").drawImage(this._image,0,0,this._sourceImage.width,this._sourceImage.height,-t,-i,this._image.clientWidth,this._image.clientHeight);var n={sWidth:this._sourceImage.width,sHeight:this._sourceImage.height,x:t,y:i,dWidth:this._image.clientWidth,dHeight:this._image.clientHeight,ratio:this._ratio,width:a,height:s,image:r.toDataURL("image/png")};this._trigger("cb.cropped",{data:n})},getData:function(){return this._data},getCb:function(){return this._cb},getMembrane:function(){return this._membrane},getImage:function(){return this._image},getFrame:function(){return this._frame},getWorkarea:function(){return this._workarea},getResize:function(){return this._resize},getVersion:function(){return"0.9.0"}},s={_configurate:function(t){this.dO={variants:[{width:200,height:200,minWidth:200,minHeight:200,maxWidth:350,maxHeight:350}]},this._cb=null,this._data=[],this._frame=null,this._image=null,this._workarea=null,this._membrane=null,this._resize=null,this._frameState={},this._imageState={},this._resizeState={},this._sourceImage=new Image,this._ratio=1,this._variants=[],this._indexVariant=0,this._disabledControls=!1,this._cb="string"==typeof t.cb?e.querySelector(t.cb):t.cb,this._variants=t.variants||this.dO.variants,this._image=this._cb.querySelector(".image-cropbox"),this._frame=this._cb.querySelector(".frame-cropbox"),this._workarea=this._cb.querySelector(".workarea-cropbox"),this._membrane=this._cb.querySelector(".membrane-cropbox"),this._resize=this._cb.querySelector(".resize-cropbox")},_initEvents:function(){this._attachFrameMouseDownEvent(),this._attachFrameMouseMoveEvent(),this._attachFrameMouseUpEvent(),this._attachResizeMouseDownEvent(),this._attachResizeMouseMoveEvent(),this._attachResizeMouseUpEvent(),this._attachImageMouseDownEvent(),this._attachImageMouseMoveEvent(),this._attachImageMouseUpEvent(),this._attachResizeWorkareaEvent(),this._attachLoadEvent(),this._attachCroppedEvent()},_initFrame:function(){var t=this._getCurrentVariant(),e=this._workarea.clientWidth/2-t.width/2,i=this._workarea.clientHeight/2-t.height/2;this._frame.style.width=t.width+"px",this._frame.style.height=t.height+"px",this._frame.style.backgroundImage='url("'+this._sourceImage.src+'")',this._refrashPosFrame(e,i)},_initImage:function(){var t=this._image.clientWidth/2-this._workarea.clientWidth/2,e=this._image.clientHeight/2-this._workarea.clientHeight/2;this._refrashPosImage(-t,-e)},_initRatio:function(){var t=this._getCurrentVariant(),e=t.width/this._sourceImage.width,i=t.height/this._sourceImage.height;this._ratio=e>i?e:i,this._zoom(this._sourceImage.width*this._ratio,this._sourceImage.height*this._ratio)},_refrashPosFrame:function(t,e){var i=this._image.offsetLeft,a=this._image.offsetTop,s=i-t,r=a-e;s>0?(s=0,t=i):this._image.clientWidth+i<t+this._frame.clientWidth&&(s=this._frame.clientWidth-this._image.clientWidth,t=i+this._image.clientWidth-this._frame.clientWidth),r>0?(r=0,e=a):this._image.clientHeight+a<e+this._frame.clientHeight&&(r=this._frame.clientHeight-this._image.clientHeight,e=a+this._image.clientHeight-this._frame.clientHeight),this._frame.style.left=t+"px",this._frame.style.top=e+"px",this._frame.style.backgroundPosition=s+"px "+r+"px"},_refrashSizeFrame:function(t,e){var i=this._image.offsetLeft,a=this._image.offsetTop,s=this._frame.offsetLeft,r=this._frame.offsetTop,n=this._frame.clientWidth,h=this._frame.clientHeight,o=this._getCurrentVariant(),_=o.maxWidth,m=o.maxHeight,c=o.minWidth,f=o.minHeight;t>n&&void 0===_?_=n:t<n&&void 0===c&&(c=n),e>h&&void 0===m?m=h:e<h&&void 0===f&&(f=h),t>_?t=_:t<c&&(t=c),this._image.clientWidth+i<s+t&&(t=this._image.clientWidth+i-s),e>m?e=m:e<f&&(e=f),this._image.clientHeight+a<r+e&&(e=this._image.clientHeight+a-r),this._frame.style.width=t+"px",this._frame.style.height=e+"px"},_refrashPosImage:function(t,e){this._image.style.left=t+"px",this._image.style.top=e+"px"},_zoom:function(t,e){this._image.style.width=t+"px",this._image.style.height=e+"px",this._frame.style.backgroundSize=t+"px "+e+"px"},_showWorkarea:function(){this._workarea.style.display="block"},_hideWorkarea:function(){this._workarea.style.display="none"},_resetVariant:function(){this._indexVariant=0},_getCurrentVariant:function(){return this._variants[this._indexVariant]},_nextVariant:function(){this._variants.length<=this._indexVariant+1&&(this._indexVariant=0,this._stop()),++this._indexVariant,this._initRatio(),this._initImage(),this._initFrame()},_clearData:function(){this._data=[]},_addData:function(t){this._data.push(t)},_start:function(){this._enableControls(),this._clearData(),this._resetVariant(),this._showWorkarea(),this._initRatio(),this._initImage(),this._initFrame()},_stop:function(){this._disableControls(),this._hideWorkarea()},_disableControls:function(){this._disabledControls=!0,this._trigger("cb.disabledCtrls")},_enableControls:function(){this._disabledControls=!1,this._trigger("cb.enabledCtrls")},_trigger:function(i,a){var s=null;t.CustomEvent?s=new CustomEvent(i,{detail:a}):(s=e.createEvent("CustomEvent"),s.initCustomEvent(i,!0,!0,a)),this._cb.dispatchEvent(s)}},r={_attachLoadEvent:function(){var t=this;this._sourceImage.addEventListener("load",function(){t._image.addEventListener("load",function(){t._start()}),t._image.src=this.src,t._trigger("cb.loaded")})},_attachFrameMouseDownEvent:function(){var t=this;this._frame.addEventListener("mousedown",function(e){t._frameState.dragable=!0,t._frameState.mouseX=e.clientX,t._frameState.mouseY=e.clientY})},_attachFrameMouseMoveEvent:function(){var t=this;this._frame.addEventListener("mousemove",function(e){if(t._frameState.dragable){var i=t._frame.offsetLeft,a=t._frame.offsetTop,s=e.clientX-t._frameState.mouseX+i,r=e.clientY-t._frameState.mouseY+a;t._frameState.mouseX=e.clientX,t._frameState.mouseY=e.clientY,t._refrashPosFrame(s,r)}})},_attachFrameMouseUpEvent:function(){var t=this;e.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation(),t._frameState.dragable=!1})},_attachResizeMouseDownEvent:function(){var t=this;this._resize.addEventListener("mousedown",function(e){e.stopImmediatePropagation(),t._resizeState.dragable=!0,t._resizeState.mouseX=e.clientX,t._resizeState.mouseY=e.clientY})},_attachResizeMouseMoveEvent:function(){var t=this;e.addEventListener("mousemove",function(e){if(t._resizeState.dragable){var i=t._frame.clientWidth,a=t._frame.clientHeight,s=e.clientX-t._resizeState.mouseX+i,r=e.clientY-t._resizeState.mouseY+a;t._resizeState.mouseX=e.clientX,t._resizeState.mouseY=e.clientY,t._refrashSizeFrame(s,r)}})},_attachResizeMouseUpEvent:function(){var t=this;e.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation(),t._resizeState.dragable=!1})},_attachImageMouseDownEvent:function(){var t=this;this._membrane.addEventListener("mousedown",function(e){t._imageState.dragable=!0,t._imageState.mouseX=e.clientX,t._imageState.mouseY=e.clientY})},_attachImageMouseMoveEvent:function(){var t=this;this._membrane.addEventListener("mousemove",function(e){if(t._imageState.dragable){var i=getComputedStyle(t._image).left,a=getComputedStyle(t._image).top,s=e.clientX-t._imageState.mouseX+parseFloat(i),r=e.clientY-t._imageState.mouseY+parseFloat(a);t._imageState.mouseX=e.clientX,t._imageState.mouseY=e.clientY,t._refrashPosImage(s,r),t._frameState.mouseX=e.clientX,t._frameState.mouseY=e.clientY,t._refrashPosFrame(parseFloat(getComputedStyle(t._frame).left),parseFloat(getComputedStyle(t._frame).top))}})},_attachImageMouseUpEvent:function(){var t=this;this._membrane.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation(),t._imageState.dragable=!1})},_attachResizeWorkareaEvent:function(){var e=this;t.addEventListener("resize",function(){e._initRatio(),e._initImage(),e._initFrame()})},_attachCroppedEvent:function(){var t=this;this._cb.addEventListener("cb.cropped",function(e){t._addData(e.detail.data),t._nextVariant()})}};return i.prototype=Object.assign(i.prototype,a,s,r),i}(window,document);